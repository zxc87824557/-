<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #game {
            margin: 8% auto;

        }

        .hole {
            width: 200px;
            height: 100px;
            background: black;
            cursor: url(./cursor.png) 50 50, auto;
            border-radius: 50%;

        }

        .red {
            background: red;
        }

        .blue {
            background: blue;
        }
    </style>
</head>

<body>
    <table id="game">
        <tr>
            <td class="hole" id="hole7"></td>
            <td class="hole" id="hole8"></td>
            <td class="hole" id="hole9"></td>
        </tr>
        <tr>
            <td class="hole" id="hole4"></td>
            <td class="hole" id="hole5"></td>
            <td class="hole" id="hole6"></td>
        </tr>
        <tr>
            <td class="hole" id="hole1"></td>
            <td class="hole" id="hole2"></td>
            <td class="hole" id="hole3"></td>
        </tr>
    </table>
    <input type="button" value="START" id="btn-start"> <br>
    目前分數: <span id="text-score">0</span>
    剩餘時間: <span id="text-time">10</span>
    <hr>
    最高分: <br>
    玩家: <span id="text-highplayer">沒有人</span> <br>
    分數: <span id="text-highscore">0</span>
    <script>
        // 宣告
        const holes = document.getElementsByClassName("hole");
        const btnStart = document.getElementById("btn-start");
        const textScore = document.getElementById("text-score");
        const textTime = document.getElementById("text-time");
        const textHighPlayer = document.getElementById("text-highplayer");
        const textHighScore = document.getElementById("text-highscore");
        // 音訊 new Audio()
        const rihai = new Audio();
        rihai.src = "./rihai.mp3";

        // 定變數
        let score = 0;
        // 是否在遊戲中
        let inGame = false;
        // 剩餘秒數
        let timeleft = 10;
        // 計時器
        let timer = 0;
        // 最高分
        let highscore = { name: '', score: 0 }
        // 將 localStorage 存的文字轉成可以使用的陣列
        let storage = JSON.parse(localStorage.getItem("highscore"));

        // 如果有分數紀錄
        if (storage != null) {
            highscore.name = storage.name;
            textHighPlayer.innerText = highscore.name;
            highscore.score = storage.score;
            textHighScore.innerText = highscore.score;
        }
        // 按鈕動作
        btnStart.onclick = () => {
            btnStart.disabled = true;
            timer = setInterval(game, 1000);
            game();
            score = 0;
            textScore.innerText = score;
            inGame = true;
            timeleft = 10;
            textTime.innerText = timeleft;
        }
        // 當遊戲開始時的動作
        const game = () => {
            for (let hole of holes) {
                hole.classList.remove("red");
                hole.classList.remove("blue");
            }
            for (let i = 0; i < 3; i++) {
                const rand = Math.floor(Math.random() * 9);
                holes[rand].classList.add("red");
            }
            timeleft--;
            textTime.innerText = timeleft;
            if (timeleft == 0) {
                inGame = false;
                clearInterval(timer);
                for (let hole of holes) {
                    hole.classList.remove("red");
                    hole.classList.remove("blue");
                }
                btnStart.disabled = false;
                alert(`你得到 ${score} 分`);
                if (storage == null || score > highscore.score) {
                    rihai.play();
                    const input = prompt("恭喜最高分，請輸入名字");
                    if (input != null && input.trim() != '') {
                        highscore.score = score;
                        highscore.name = input;
                        textHighPlayer.innerText = highscore.name;
                        textHighScore.innerText = highscore.score;
                        localStorage.setItem("highscore", JSON.stringify(highscore));
                    }
                }
            }
        }
        // 滑鼠設定
        for (let hole of holes) {
            hole.onclick = () => {
                if (inGame && hole.classList.contains("red")) {
                    hole.classList.add("blue");
                    hole.classList.remove("red");
                    score++;
                    textScore.innerText = score;
                }
            }
        }
        // 鍵盤設定
        document.onkeydown = (event) => {
            const key = event.key;
            if (!isNaN(key) && inGame && key > 0 && key < 10) {
                const target = document.getElementById(`hole${key}`);
                target.click();
            }
        }
    </script>
</body>

</html>